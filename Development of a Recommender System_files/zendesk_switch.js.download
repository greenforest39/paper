!function(){if(document.querySelector("#botxo-iframeContainer-1")){certainly.WEBCHAT_KEY="1",certainly.zendesk_extension={};var e=document.querySelector("#botxo-iframeContainer-1"),t=document.querySelector("#certainly-custom-zendesk-style");e&&!t&&a();var n=setInterval(function(){void 0!==window.zE&&(zE(function(){s()}),clearInterval(n))},100)}else window.addEventListener("onWidgetReady",({detail:e})=>{certainly.WEBCHAT_KEY="1",certainly.zendesk_extension={};var t=document.querySelector("#botxo-iframeContainer-1"),n=document.querySelector("#certainly-custom-zendesk-style");t&&!n&&a();var i=setInterval(function(){void 0!==window.zE&&(zE(function(){s()}),clearInterval(i))},100)});function a(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var e=document.querySelector("#botxo-chat-1"),t=document.querySelector("#botxo-iframeContainer-1");document.head.insertAdjacentHTML("beforeend",`
        <style id="certainly-custom-zendesk-style">
            @media only screen and (min-width: 767px) {
                #webWidget {
                    width: ${t.offsetWidth}!important;
                    max-height: calc(100vh - 32px);
                    height: ${t.offsetHeight}!important;
                    right: calc( ${getComputedStyle(e).right} + ${getComputedStyle(t).right})!important;
                    bottom: calc( ${getComputedStyle(e).bottom} + ${getComputedStyle(t).bottom})!important;
                }
            }
        </style>`)}}var i=document.createElement("script");function s(){zE(function(){zE("webWidget","hide"),zE("webWidget:get","chat:isChatting")&&(zE("webWidget","show"),zE("webWidget","open"),certainly.hideChatQueue(),certainly.widgetStatus({action:"close"}),certainly.widgetStatus({action:"hide"})),zE("webWidget:on","chat:end",function(){zE("webWidget","hide"),certainly.widgetStatus({action:"show"}),certainly.widgetStatus({action:"open"},function(){"queue_canceled"!==certainly.zendesk_extension.last_event&&"queue_timeout"!==certainly.zendesk_extension.last_event&&certainly.sendHiddenMessage("CERTAINLY_TAKEOVER")})})});var e=document.createElement("script");e.src="https://scripts.certainly.io/extensions/certainly_chat_queue/chat_queue.js",e.onload=function(){window.addEventListener("certainly",function(e){"queue_timeout"==e.detail&&(zE("webWidget","chat:addTags",["certainly_chat_queue_timeout"]),setTimeout(function(){certainly.zendesk_extension.last_event="queue_timeout",zE("webWidget","chat:end")},1e3)),"queue_canceled"==e.detail&&(zE("webWidget","chat:addTags",["certainly_chat_queue_canceled"]),setTimeout(function(){certainly.zendesk_extension.last_event="queue_canceled",zE("webWidget","chat:end")},1e3))}),certainly.sendHiddenMessage=function(e){certainly.sendMessage({sender:"user",message:e,visible:!1,webchatKey:"WEBCHAT_KEY"in certainly?certainly.WEBCHAT_KEY:"1"})},certainly.getCertainlyTransfer({actionName:"*",callback:function(e){var t=document.querySelector("#botxo-iframeContainer-1"),n=document.querySelector("#certainly-custom-zendesk-style");if(t&&!n&&a(),0==Object.getOwnPropertyNames(e.cvars).length&&console.log("You need to enable your Certainly bot to expose custom variables"),e.cvars.zendesk&&"agent_availability"==e.cvars.zendesk){var i=zE("webWidget:get","chat:departments"),s=!1;"zendesk_department"in e.cvars&&""!=e.cvars.zendesk_department&&'""'!=e.cvars.zendesk_department?i.forEach(function(t){"online"==t.status&&(t.name==e.cvars.zendesk_department||e.cvars.zendesk_department.split(",").includes(t.name))&&(s=!0)}):i.forEach(function(e){"online"==e.status&&(s=!0)}),s?certainly.sendHiddenMessage("AGENTS_ONLINE"):certainly.sendHiddenMessage("AGENTS_OFFLINE")}if(e.cvars.zendesk&&"start_chat"==e.cvars.zendesk){zE("webWidget","identify",{name:e.cvars.visitor_name?e.cvars.visitor_name:"Anonymous Visitor",email:e.cvars.visitor_email?e.cvars.visitor_email:"visitor@email.com"}),"zendesk_department"in e.cvars&&zE("webWidget","updateSettings",{webWidget:{chat:{departments:{select:e.cvars.zendesk_department}}}});var r=e.cvars.chatHistory?e.cvars.chatHistory:"The transcript between Certainly and this visitor is not available",c=["chat_with_certainly","handed_over_by_certainly"];if("zendesk_tags"in e.cvars){c=c.concat(e.cvars.zendesk_tags.split(","));for(var o=0;o<c.length;o++)c[o]=c[o].replace(" ","_")}zE("webWidget","chat:addTags",c),zE("webWidget","chat:send",r),certainly.showChatQueue(e.cvars?.chat_queue_timeout),zE("webWidget:on","userEvent",function(e){"Chat Served by Operator"==e.action&&(certainly.hideChatQueue(),zE("webWidget","show"),zE("webWidget","open"),certainly.widgetStatus({action:"close"}),certainly.widgetStatus({action:"hide"}))})}}})},document.head.appendChild(e)}i.src="https://scripts.certainly.io/extensions/certainly_chat_queue/chat_queue.js",document.head.appendChild(i)}();